<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×§×¨×™×•×§×™ - ××¢×¨×›×ª × ×™×”×•×œ</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #121212; color: white; text-align: center; margin: 0; padding: 0; }
        
        /* --- ×¢×™×¦×•×‘ ×›×œ×œ×™ --- */
        h1 { margin: 10px 0; font-size: 1.5rem; color: #ff0055; }
        
        /* --- ××–×•×¨ ×”×× ×”×œ (××•×¡×ª×¨ ×œ××•×¨×—×™×) --- */
        #admin-panel { 
            display: none; /* ××•×¡×ª×¨ ×›×‘×¨×™×¨×ª ××—×“×œ */
            background: #1e1e1e; 
            padding: 15px; 
            border-bottom: 3px solid #00e676;
            margin-bottom: 20px;
        }
        
        /* ×”× ×’×Ÿ */
        #player-container { margin: 0 auto; max-width: 640px; }

        /* --- ××–×•×¨ ×”××•×¨×—×™× (×—×™×¤×•×©) --- */
        .guest-area { padding: 20px; max-width: 600px; margin: 0 auto; }
        
        input { padding: 12px; width: 90%; margin-bottom: 10px; font-size: 16px; background: #333; color: white; border: 1px solid #555; border-radius: 8px; }
        .btn-main { background: #ff0055; color: white; width: 100%; padding: 12px; font-size: 18px; border: none; border-radius: 8px; cursor: pointer; }
        
        /* --- ×¨×©×™××ª ×”×©×™×¨×™× --- */
        ul { list-style: none; padding: 0; max-width: 600px; margin: 0 auto; padding-bottom: 50px; }
        li { 
            background: #252525; margin: 8px 10px; padding: 15px; 
            display: flex; justify-content: space-between; align-items: center; 
            border-radius: 8px; text-align: right; box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        
        .song-info { flex-grow: 1; }
        .singer-label { color: #ff0055; font-size: 0.85em; font-weight: bold; display: block; }
        .song-title { font-size: 1.1em; }

        /* --- ×›×¤×ª×•×¨×™ ×©×œ×™×˜×” ×œ×× ×”×œ --- */
        .admin-controls { display: none; gap: 5px; } /* ××•×¡×ª×¨ ×œ××•×¨×—×™× */
        
        .btn-play { background: #00e676; color: black; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-del { background: #ff4444; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; }
        .btn-up { background: #007bff; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; }

        /* ×›×¤×ª×•×¨ ×”×ª×—×‘×¨×•×ª ×¡×•×“×™ */
        #dj-login-btn { 
            background: transparent; border: none; color: #333; 
            position: fixed; bottom: 10px; left: 10px; font-size: 12px; cursor: pointer;
        }
    </style>
</head>
<body>

    <div id="admin-panel">
        <h2 style="margin:0 0 10px 0; color:#00e676;">ğŸ§ ×¢××“×ª DJ</h2>
        <div id="player-container">
            <div id="player"></div>
        </div>
        <h3 id="now-playing" style="color: white;">×××ª×™×Ÿ ×œ×‘×—×™×¨×”...</h3>
    </div>

    <h1>ğŸ¤ ×§×¨×™×•×§×™ ×—×‘×¨×ª×™</h1>
    
    <div class="guest-area">
        <input type="text" id="userName" placeholder="×”×©× ×©×œ×š (×—×•×‘×”)">
        <input type="text" id="searchIn" placeholder="××™×–×” ×©×™×¨ ×œ×—×¤×©?">
        <button class="btn-main" onclick="doSearch()">×—×¤×© ×•×”×•×¡×£ ×œ×ª×•×¨ ğŸ”</button>
    </div>

    <div id="results" style="max-width:600px; margin:0 auto;"></div>

    <h3 style="margin-top:30px; color:#aaa;">×¨×©×™××ª ×”××ª× ×”:</h3>
    <ul id="queue"></ul>

    <button id="dj-login-btn" onclick="adminLogin()">Admin Login ğŸ”’</button>

    <script>
        // ==========================================
        // 1. ××¤×ª×—×•×ª (×œ×”×“×‘×™×§ ×›××Ÿ!)
        // ==========================================
              const YOUTUBE_API_KEY = 'AIzaSyCID8UzGuJDQE3e_3tY_xvbxQftQzwSwEA'; // *** ×”×›× ×¡ ×›××Ÿ ××ª ××¤×ª×— ×”×™×•×˜×™×•×‘ ×©×œ×š ***
                
        const firebaseConfig = {
            // *** ×”×›× ×¡ ×›××Ÿ ××ª ×”-Config ×-Firebase ***
            apiKey: "AIzaSyB3wOy7kFxXOPA1a8zWZmtlakXe7oXOsv0",
            authDomain: "tt-karaoke.firebaseapp.com",
            databaseURL: "https://tt-karaoke-default-rtdb.firebaseio.com",
            projectId: "tt-karaoke",
            storageBucket: "tt-karaoke.firebasestorage.app",
            messagingSenderId: "194564552518",
            appId: "1:194564552518:web:19ad2151e5c5bc53c79747",
            measurementId: "G-SN8MNYFCH6"
        };


        // ==========================================
        // 2. ××ª×—×•×œ
        // ==========================================
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const queueRef = db.ref('partyQueue'); 

        let player;
        let isAdmin = false; // ××¦×‘ ×”×ª×—×œ×ª×™: ××•×¨×—
        
        // ×˜×¢×™× ×ª ×©× ××©×ª××© ××”×–×™×›×¨×•×Ÿ
        document.getElementById('userName').value = localStorage.getItem('karaokeName') || '';

        // ==========================================
        // 3. ×ª×¦×•×’×ª ×”×ª×•×¨ (×—×›××”: ×‘×•×“×§×ª ×× ××ª×” ×× ×”×œ)
        // ==========================================
        queueRef.on('value', (snapshot) => {
            const listEl = document.getElementById('queue');
            listEl.innerHTML = '';

            // ×”××¨×” ×œ××¢×¨×š ×›×“×™ ×©× ×•×›×œ ×œ××™×™×Ÿ ××• ×œ× ×”×œ
            let songs = [];
            snapshot.forEach(child => {
                songs.push({ key: child.key, ...child.val() });
            });

            // ×× ××™×Ÿ ×©×™×¨×™×
            if (songs.length === 0) {
                listEl.innerHTML = '<p style="color:#555;">×”×ª×•×¨ ×¨×™×§ ×›×¨×’×¢... ×ª×”×™×” ×”×¨××©×•×Ÿ!</p>';
                return;
            }

            songs.forEach(song => {
                const li = document.createElement('li');
                
                // HTML ×©×œ ×”×©×•×¨×”
                let html = `
                    <div class="song-info">
                        <span class="singer-label">${song.addedBy || '××•×¨×—'}</span>
                        <span class="song-title">${song.title}</span>
                    </div>
                `;

                // ×× ×”××©×ª××© ×”×•× ×× ×”×œ - × ×•×¡×™×£ ×›×¤×ª×•×¨×™ ×©×œ×™×˜×”
                if (isAdmin) {
                    html += `
                        <div class="admin-controls" style="display:flex;">
                            <button class="btn-play" onclick="playSong('${song.videoId}', '${song.title.replace(/'/g, "")}')">â–¶</button>
                            <button class="btn-del" onclick="deleteSong('${song.key}')">ğŸ—‘</button>
                        </div>
                    `;
                }

                li.innerHTML = html;
                listEl.appendChild(li);
            });
        });

        // ==========================================
        // 4. ×œ×•×’×™×§×” ×œ×× ×”×œ ×‘×œ×‘×“
        // ==========================================
        function adminLogin() {
            const pass = prompt("×”×›× ×¡ ×¡×™×¡××ª DJ:");
            if (pass === "1234") { // ×›××Ÿ ×§×•×‘×¢×™× ××ª ×”×¡×™×¡××”
                isAdmin = true;
                alert("×‘×¨×•×š ×”×‘× DJ! ×”××¢×¨×›×ª × ×¤×ª×—×”.");
                
                // ×—×©×™×¤×ª ×¤×× ×œ ×”× ×™×”×•×œ
                document.getElementById('admin-panel').style.display = 'block';
                document.getElementById('dj-login-btn').style.display = 'none'; // ×”×¡×ª×¨×ª ×›×¤×ª×•×¨ ×”×œ×•×’×™×Ÿ
                
                // ×˜×¢×™× ×ª ×”× ×’×Ÿ
                loadYoutubePlayer();
                
                // ×¨×¢× ×•×Ÿ ×”×¨×©×™××” ×›×“×™ ×œ×”×¦×™×’ ×›×¤×ª×•×¨×™×
                // (×× ×—× ×• ×¤×©×•×˜ ×§×•×¨××™× ××—×“×© ×œ×“××˜×”×‘×™×™×¡ ×¢"×™ ×˜×¨×™×’×¨ ×¤×™×§×˜×™×‘×™ ××• ×©×”×¨×¢× ×•×Ÿ ×”×‘× ×™×§×¨×” ×œ×‘×“. 
                // ×”×›×™ ×¤×©×•×˜: ×œ×”×¤×¢×™×œ ××—×“×© ××ª ×”-listener, ××‘×œ ×›××Ÿ × ×¡×ª××š ×¢×œ ×”×¢×“×›×•×Ÿ ×”×‘× ××• × ×¨×¢× ×Ÿ ×“×£ ×× ×¦×¨×™×š. 
                // ×œ××¢×Ÿ ×”×¤×©×˜×•×ª: × ×‘×§×© ××”××©×ª××© ×œ×¨×¢× ×Ÿ ××• ×©×¤×©×•×˜ × ×—×›×” ×©××™×©×”×• ×™×•×¡×™×£ ×©×™×¨. 
                // ×ª×™×§×•×Ÿ: × ×§×¨× ×™×“× ×™×ª ×œ×¤×•× ×§×¦×™×” ×©××¨× ×“×¨×ª ×× ×”×™×” ×œ× ×• ××•×ª×” ×‘× ×¤×¨×“, ××‘×œ ×”-Realtime ×™×¢×‘×•×“)
                
                // ×˜×¨×™×§ ×œ×¨×¢× ×•×Ÿ ×”×ª×¦×•×’×” ×”× ×•×›×—×™×ª:
                queueRef.once('value'); 
                // (×‘×¤×•×¢×œ ×”×“×¨×š ×”×›×™ ×˜×•×‘×” ××—×¨×™ ×œ×•×’×™×Ÿ ×‘-SPA ×¤×©×•×˜ ×›×–×” ×”×™× ×©×”××©×ª××© ×™×¨××” ××ª ×”×›×¤×ª×•×¨×™× ×‘×¤×¢× ×”×‘××” ×©×”×¨×©×™××” ××ª×¢×“×›× ×ª, 
                // ××‘×œ ×›×“×™ ×©×–×” ×™×§×¨×” ××™×“, × ×‘×¦×¢ ×¨×¢× ×•×Ÿ ×œ×“×£ ×•× ×©××•×¨ ××ª ×”×¡×˜×˜×•×¡ ×‘-LocalStorage, ××• ×¤×©×•×˜ × ×©××™×¨ ×›×›×”).
                
                // ×©×™×¤×•×¨: ×©××™×¨×ª ××¦×‘ ××“××™×Ÿ ×‘×–×™×›×¨×•×Ÿ ×œ× ×©×•×¨×“×ª ×¨×¢× ×•×Ÿ ×‘×œ×™ ×§×•×“ × ×•×¡×£, ××– ×¤×©×•×˜ × ×©××™×¨ ××ª ×–×” ×œ-session ×”× ×•×›×—×™.
                // ×›×“×™ ×©×™×¨××• ×›×¤×ª×•×¨×™× ××™×“:
                 window.location.reload(); 
                 localStorage.setItem('isAdminMode', 'true');
            } else {
                alert("×¡×™×¡××” ×©×’×•×™×”");
            }
        }

        // ×‘×“×™×§×” ×‘×¢×ª ×˜×¢×™× ×ª ×”×“×£ ×× ×× ×—× ×• ×›×‘×¨ ×× ×”×œ×™× (××—×¨×™ ×¨×¢× ×•×Ÿ)
        if (localStorage.getItem('isAdminMode') === 'true') {
            isAdmin = true;
            document.getElementById('admin-panel').style.display = 'block';
            document.getElementById('dj-login-btn').style.display = 'none';
            loadYoutubePlayer();
        }

        function loadYoutubePlayer() {
            if (!window.YT) {
                var tag = document.createElement('script');
                tag.src = "https://www.youtube.com/iframe_api";
                var firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
            }
        }

        function onYouTubeIframeAPIReady() {
            if(isAdmin) {
                player = new YT.Player('player', {
                    height: '360',
                    width: '100%',
                    playerVars: { 'autoplay': 1, 'controls': 1 },
                });
            }
        }

        // ×¤×•× ×§×¦×™×•×ª ×©×œ×™×˜×” (×¨×§ ×œ×× ×”×œ ×™×© ×’×™×©×” ×œ×›×¤×ª×•×¨×™× ×©××¤×¢×™×œ×™× ××•×ª×Ÿ)
        function playSong(videoId, title) {
            if(!player) return;
            document.getElementById('now-playing').innerText = "××ª× ×’×Ÿ: " + title;
            player.loadVideoById(videoId);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function deleteSong(key) {
            if(confirm("×œ××—×•×§ ××ª ×”×©×™×¨ ××”×ª×•×¨?")) {
                queueRef.child(key).remove();
            }
        }

        // ==========================================
        // 5. ×—×™×¤×•×© ×•×”×•×¡×¤×” (×œ××•×¨×—×™× ×•×œ×× ×”×œ)
        // ==========================================
        async function doSearch() {
            const q = document.getElementById('searchIn').value;
            const name = document.getElementById('userName').value;
            
            if (!name) { alert("×—×•×‘×” ×œ×”×›× ×™×¡ ×©×!"); return; }
            if (!q) { alert("×—×•×‘×” ×œ×”×›× ×™×¡ ×©× ×©×™×¨!"); return; }
            
            localStorage.setItem('karaokeName', name);

            const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=5&q=${encodeURIComponent(q + " karaoke")}&key=${YOUTUBE_API_KEY}`;
            
            try {
                const res = await fetch(url);
                const data = await res.json();
                const resDiv = document.getElementById('results');
                resDiv.innerHTML = '';

                if (data.items) {
                    data.items.forEach(item => {
                        resDiv.innerHTML += `
                            <div style="background:#222; margin:10px 0; padding:10px; display:flex; align-items:center; border-radius:5px;">
                                <img src="${item.snippet.thumbnails.default.url}" width="60" style="margin-left:10px;">
                                <div style="flex-grow:1; text-align:right;">
                                    <div style="font-size:0.9em; font-weight:bold;">${item.snippet.title}</div>
                                </div>
                                <button class="btn-main" style="width:auto; padding:5px 15px; font-size:14px; background:green;" 
                                onclick="add('${item.id.videoId}', '${item.snippet.title.replace(/'/g, "")}')">×‘×—×¨</button>
                            </div>
                        `;
                    });
                }
            } catch(e) { alert("×©×’×™××” ×‘×—×™×¤×•×©"); }
        }

        function add(id, title) {
            const name = document.getElementById('userName').value;
            queueRef.push({
                videoId: id,
                title: title,
                addedBy: name,
                timestamp: Date.now()
            });
            document.getElementById('results').innerHTML = '<p style="color:#00e676; font-weight:bold;">âœ… ×”×©×™×¨ × ×©×œ×— ×œ-DJ!</p>';
            document.getElementById('searchIn').value = '';
        }

    </script>
</body>
</html>
